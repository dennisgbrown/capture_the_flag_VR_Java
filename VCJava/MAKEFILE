# Makefile for VCJavaWidget--dynamically loaded native C library for java


###############
# DEFINITIONS
###############

JAVAC = javac
JAVAH = javah

# locations necessary for JAVA build
JAVAHOME=/tmp_mnt/net/buzzard/dewan/brownde/CosmoCode/usr/java
JAVASHAREINC = $(JAVAHOME)/include

# subdirectory to put the c stubs generated by JAVAH
CLASSSTUBDIR = CClassStubs
# subdirectory to put the C header files produced by JAVAH
CHEADERDIR  = CClassHeaders
# subdirectory where the C Native code files live
CNATIVEDIR  = CNativeCode

# the name of the package has to match the name of the subdirectory that
# the java source and java class files sit in
PACKAGEDIR = VCOLLIDE

# name of the shared library we will create (under Solaris)
LIBRARY = libVCJava.so

# classes which rely on native methods
EXPORTEDCLASS = $(PACKAGEDIR).VCJavaWidget


###########
# TARGETS
###########

# make library to make the damn library already
VCJava: $(LIBRARY)

# Java classes
$(PACKAGEDIR)/VCJavaWidget.class: $(PACKAGEDIR)/VCJavaWidget.java
	$(JAVAC) $(PACKAGEDIR)/VCJavaWidget.java 

$(PACKAGEDIR)/VCJavaWidgetOpenFailedException.class: \
               $(PACKAGEDIR)/VCJavaWidgetOpenFailedException.java
	$(JAVAC) $(PACKAGEDIR)/VCJavaWidgetOpenFailedException.java 

classheaders : $(PACKAGEDIR)/VCJavaWidget.class \
               $(PACKAGEDIR)/VCJavaWidgetOpenFailedException.class
	$(JAVAH) -d $(CHEADERDIR)/ $(EXPORTEDCLASS)

stubs : classheaders 
	$(JAVAH) -d $(CLASSSTUBDIR) -stubs $(EXPORTEDCLASS)

nativeMake : 
	cd CNativeCode; make library

# the libstubs.c file is generated to keep all the JAVAH machine generated 
# in one file to link into the shared library
$(CNATIVEDIR)/libstubs.c : classheaders
	$(JAVAH) -d $(CLASSSTUBDIR)/ -stubs $(EXPORTEDCLASS)
	@ cat $(CLASSSTUBDIR)/*.c > $@

# making the library will create the .so shared library to be loaded in at
# runtime
$(LIBRARY): classheaders $(CNATIVEDIR)/libstubs.c nativeMake

# clean out the *.o files and machine generated files from javah
clean:
	rm -f *.o CNativeCode/libstubs.c CNativeCode/*.o \
	CClassStubs/* CClassHeaders/* $(LIBRARY)
















